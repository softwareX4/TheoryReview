# 操作系统
## 概述
### 基本功能
- 进程/线程管理
- 存储管理
- 文件管理
- 设备管理
- 用户接口
### 特征
- 并发
- 共享
- 虚拟
- 随机
### CPU状态
用户态 =》 非特权指令
内核态 =》 特权指令
不同级别的指令能运行的指令集不同
用户态到内核态的唯一途径：中断、异常、陷入机制
内核态到用户态：设置程序状态字PSW
#### 中断、异常
- 随机的
- 自动处理
- 可恢复
硬件完成响应，软件完成处理过程
硬件取指令，执行完之后扫描有无中断，若有则保存寄存器信息到系统堆栈（主要是程序状态字PSW、程序计数器PC），根据中断码，查中断向量表，找到处理程序入口，设置PC。中断返回，恢复现场。
## 进程
正在执行的程序
PCB：OS 感知进程的方式，放在一起形成进程表
资源分配和调度的单元

CPU可以调度线程
### 线程
- 用户级线程
用户空间维护线程表，内核感知不到。用户提供调度算法，切换速度快。但：CPU分配到进程，因此即使多核也不能将线程分配到不同CPU，且若一个线程阻塞，系统看不到线程，会将整个进程阻塞。
- 核心级线程
操作系统既维护进程表又维护线程表
- 混合线程
内核负责调度，用户空间负责创建。实现：多路复用，将用户线程对应到内核线程。
### 进程间通信
- 消息传递
进程不能访问别的进程的空间，OS设置消息缓冲区
陷入内核、复制消息、消息入队、复制消息
- 共享内存
同一块物理内存映射到进程的地址空间，读写者解决互斥
- 管道
利用传输介质（内存或文件）
字符流写入读出，先入先出，互斥、同步
- 套接字
- 远程过程调用
## IO模型
- 阻塞IO
- 非阻塞IO
- IO多路复用
  - select
  - poll
  - epoll
- 异步IO